(function(e,n){e(function(){function e(e){var n=e.split("-"),t=n[n.length-1],r={code:v[t]};if(!r.code)throw'Unknown key "'+t+'" in keystring "'+e+'"';for(var a,i=0;n.length-1>i;i++){if(t=n[i],a=p[t],!a)throw'Unknown modifier "'+t+'" in keystring "'+e+'"';r[a]=!0}return r}function t(e){for(var n="",t=0;d.length>t;t++)e[d[t]]&&(n+=d[t]+"-");return n+=h[e.code]}function r(n){for(var r=[],a=n.split(" "),i=0;a.length>i;i++){var o=e(a[i]);o=t(o),r.push(o)}return r.original=n,r}function a(e){for(var n={code:e.keyCode},r=0;s.length>r;r++){var a=s[r];e[a]&&(n[a.slice(0,a.length-3)]=!0)}return t(n)}function i(e,n){for(var t=0;n.length>t;t++){var r=n[t];if(r&&(e=e[r]),!e)break}return e}function o(e){if(!~g.indexOf(e.keyCode)){var t=S.slice();t.push(a(e));for(var r,o,f,c=y.split("."),l=c.length;l>=0;l--)if(o=i(w,c.slice(0,l))){r=!0;for(var u=0;t.length>u;u++){if(f=t[u],!o[f]){r=!1;break}o=o[f]}if(r)break}var s=c.slice(0,l).join("."),p=o.preventDefault;if(r&&!o.handlers)return S=t,p&&e.preventDefault(),n;if(r)for(l=0;o.handlers.length>l;l++){var d=o.handlers[l],v=d._keymage,h=d.call(v.context,e,{shortcut:v.original,scope:y,definitionScope:s});(h===!1||p)&&e.preventDefault()}S=[]}}function f(e,n,t){var r=e.split("."),a=w;r=r.concat(n);for(var i=0,o=r.length;o>i;i++){var f=r[i];if(f&&(a=a[f]||(a[f]={}),t._keymage.preventDefault&&(a.preventDefault=!0),i===o-1)){var c=a.handlers||(a.handlers=[]);c.push(t)}}}function c(e,t,a,i){if(t===n&&a===n)return function(n,t){return c(e,n,t)};"function"==typeof t&&(i=a,a=t,t=e,e="");var o=r(t);a._keymage=i||{},a._keymage.original=t,f(e,o,a)}var l,u="1.0.1",s=["shiftKey","ctrlKey","altKey","metaKey"],p={shift:"shift",ctrl:"ctrl",control:"ctrl",alt:"alt",option:"alt",win:"meta",cmd:"meta","super":"meta",meta:"meta",defmod:~navigator.userAgent.indexOf("Mac OS X")?"meta":"ctrl"},d=["shift","ctrl","alt","meta"],g=[16,17,18,91],v={backspace:8,tab:9,enter:13,"return":13,pause:19,caps:20,capslock:20,escape:27,esc:27,space:32,pgup:33,pageup:33,pgdown:34,pagedown:34,end:35,home:36,ins:45,insert:45,del:46,"delete":46,left:37,up:38,right:39,down:40,"*":106,"+":107,plus:107,"-":109,minus:109,";":186,"=":187,",":188,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222};for(l=0;10>l;l++)v["num-"+l]=l+95;for(l=0;10>l;l++)v[l+""]=l+48;for(l=1;25>l;l++)v["f"+l]=l+111;for(l=65;91>l;l++)v[String.fromCharCode(l).toLowerCase()]=l;var h={};for(var m in v){var k=v[m];(!h[k]||m.length>h[k].length)&&(h[k]=m)}var y="",w={},S=[];return c.parse=e,c.stringify=t,c.bindings=w,c.setScope=function(e){y=e?e:""},c.getScope=function(){return y},c.pushScope=function(e){return y=(y?y+".":"")+e},c.popScope=function(e){var n;return e?(y=y.replace(RegExp("(^|\\.)"+e+"(\\.|$).*"),""),e):(n=y.lastIndexOf("."),e=y.slice(n+1),y=-1==n?"":y.slice(0,n),e)},c.clear=function(){y="",w={}},c.version=u,window.addEventListener("keydown",o,!1),c})})("undefined"!=typeof define?define:function(e){window.keymage=e()});